# 使用Log4j

*项目：logging-log4j*

​	Commons Logging是一个日志接口，自然会有真正的日志实现，例如本节的Log4j



## Log4j	

​	Log4j是一种非常流行的日志框架，最新版本是2.x

​	Log4j是一个组件化设计的日志系统，它的架构大致如下：

```
log.info("User signed in.");
 │
 │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
 ├──▶│ Appender │───▶│  Filter  │───▶│  Layout  │───▶│ Console  │
 │   └──────────┘    └──────────┘    └──────────┘    └──────────┘
 │
 │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
 ├──▶│ Appender │───▶│  Filter  │───▶│  Layout  │───▶│   File   │
 │   └──────────┘    └──────────┘    └──────────┘    └──────────┘
 │
 │   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
 └──▶│ Appender │───▶│  Filter  │───▶│  Layout  │───▶│  Socket  │
     └──────────┘    └──────────┘    └──────────┘    └──────────┘
```

​	当我们使用Log4j输出一条日志时，Log4j自动通过不同的Appender把同一条日志输出到不同的目的地。

- console：输出到屏幕；
- file：输出到文件；
- socket：通过网络输出到远程计算机；
- jdbc：输出到数据库

​	Filter负责过滤哪些log需要被输出，哪些log不需要被输出。例如，仅输出ERROR级别的日志。

​	最后，通过Layout来格式化日志信息，例如，自动添加日期、时间、方法名称等信息



## 配置

​	虽然看上去结构复杂，但是实际使用的时候，并不需要关心Log4j的API，而是通过配置文件配置它。

​	以XML配置为例，使用Log4j的时候，我们把一个log4j2.xml的文件放到classpath下就可以让Log4j读取配置文件并按照我们的配置来输出日志。



​	虽然配置Log4j比较繁琐，但是一旦配置完成，使用起来就非常方便了。对上面的配置文件，凡事INFO级别的日志，会自动输出到屏幕，而ERROR级别的日志，不但会输出到屏幕，还会同时输出到文件。并且，一旦日志文件达到指定大小（1MB），Log4j就会自动切割新的日志文件，并最多保留10份





​	有了配置文件还不够，因为Log4j也是一个第三方库，我们需要从官网下载Log4j，解压后，把下面这些放到依赖

https://logging.apache.org/log4j/2.x/download.html



- log4j-api-2.x.jar
- log4j-core-2.x.jar
- log4j-jcl-2.x.jar



​	因为我们需要用Commons Logging这个日志接口，所以要把它的依赖也加进去







